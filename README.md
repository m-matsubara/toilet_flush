# toilet_flush

## 概要
配管上の問題でトイレ詰まりをよく起こすトイレにおいて、使用後に念入りに流すため、離席後一定時間たったら（離席時に流すが、タンクに水がたまるのを待つ）、再度タイマーでトイレを流す（大）。


## 対象機材（トイレ）
* リモコンで流す動作可能なINAXシャワートイレ (プレアス DT-CL114A・CH184A用リモコンで確認)
  (リモコンのコマンドが異なる場合、送信コマンドを赤外線センサで解析する必要があります。)

## 必要機材（このプログラムを動作させるのに使用する機材）
* M5StickC Plus
* M5Stack用赤外線送受信ユニット [U002] (本体の赤外線LEDが使える場合は不要・送信コマンドを赤外線センサで解析する必要がある場合は必要)
* M5StickC ToF Hat（必須ではない。使用した場合は、M5ボタンの代わりに距離センサーで操作可能)


## 機能
1. 着座を待つ。
2. 着座後、2分経過したら離席待ちとする。
3. 離席後、カウントダウンして2分たったらトイレを流す。 
4. 離席後、カウントダウン中に再度着座したら、2の離席待ちに戻る。
5. M5ボタンを1回押すとディスプレイ点灯。もう一度押すと手動のカウントダウン開始。カウントダウン中に再度押すと1の着座待ちに戻る（ディスプレイ消灯）。


## 設置
* トイレのふたが閉じた状態でディスプレイが前・USB Type-Cのコネクタが下を向くように、ふたを開けるとディスプレイが上を向くように、トイレのふたの横に両面テープ等で張り付ける。  
  (45°で着座/離席を判定するが、70°以上での使用を推奨)
* M5Stack用赤外線送受信ユニットはM5StickC Plusの裏やトイレに赤外線を送信できる位置に両面テープなどで固定。


## カスタマイズ(toilet_flush.ino)
* 赤外線送信を行う赤外線LEDの選択
  * IR_LED の値を変更する(内蔵赤外線 LEDを使用する場合 9、M5Stack用赤外線送受信ユニット(GROVE互換端子)を使用する場合 32)
* 着座してトイレを流す機能を使用する判定のタイマー時間を変更する場合
  * SITDOWN_TIMER をミリ秒単位で指定する。
* トイレを流すカウントダウンタイマー時間を変更する場合
  * COUNTDOWN_TIMER をミリ秒単位で指定する。
* 赤外線送信コマンドが異なる場合
  * IRremoteESP8266のサンプルのIRrecvDumpV2などを使ってコマンドを解析する。
  * 解析したコマンドを元に flush() 関数中の赤外線送信コマンド箇所を修正する。
  ```
  irsend.sendInax(0x5C30CF);
  ```
